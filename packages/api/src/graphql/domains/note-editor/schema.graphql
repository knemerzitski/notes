################################ UserCollabTextEditState ################################

type UserCollabTextEditState {
  "latestSelection applies to text at this revision"
  revision: NonNegativeInt!
  "Latest updated selection range"
  latestSelection: CollabTextSelectionRange!
}

################################ Subscription noteEditorEvents ################################

union NoteEditorMutations

type NoteEditorEventsPayload {
  "Self-descriptive"
  mutations: [NoteEditorMutations!]
}

extend type Subscription {
  # TODO rename to noteTextEditEvents
  "Subscribe to all events that are related to editing of specific note"
  noteEditorEvents(noteId: ObjectID!): NoteEditorEventsPayload! @auth
}

################################ NoteEditorEventsSubscribed ################################

"This payload will be sent when user has successfully subscribed to noteEditorEvents"
type NoteEditorEventsSubscribed {
  "Always true"
  subscribed: Boolean!
}

extend union SignedInUserMutations = NoteEditorEventsSubscribed

################################ PublicUserNoteLink ################################

extend type PublicUserNoteLink {
  "If defined then user is currently subscribed to noteEditorEvents and is editing note"
  textEditState: UserCollabTextEditState
}

################################ Events User Subscribed/Unsubscribed ################################

type NoteEditorUserSubscribedEvent {
  "This user started subscribing to note editor events."
  user: PublicUser!
  "Affected Note"
  note: Note!
}

type NoteEditorUserUnsubscribedEvent {
  "This user stopped subscribing to note editor events."
  user: PublicUser!
  "Affected Note"
  note: Note!
}

extend union SignedInUserMutations =
  | NoteEditorUserSubscribedEvent
  | NoteEditorUserUnsubscribedEvent

################################ Mutation updateNoteEditorSelectionRange ################################

input UpdateNoteEditorSelectionRangeInput {
  "Note.id"
  noteId: ObjectID!
  "Selection applies to this revision of text"
  revision: NonNegativeInt!
  "New selection range"
  selectionRange: CollabTextSelectionRangeInput!
}

type UpdateNoteEditorSelectionRangePayload {
  "Editing state for CollabText"
  textEditState: UserCollabTextEditState!
  "CollabText that is being edited"
  collabText: CollabText!
  "This note CollabText is being edited"
  note: Note!
  "Editing state applies to this user"
  user: PublicUser!
}

extend type Mutation {
  updateNoteEditorSelectionRange(
    input: UpdateNoteEditorSelectionRangeInput!
  ): UpdateNoteEditorSelectionRangePayload! @auth
}

extend union NoteEditorMutations = UpdateNoteEditorSelectionRangePayload
extend union SignedInUserMutations = UpdateNoteEditorSelectionRangePayload
